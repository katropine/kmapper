<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Kmapper by katropine</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Kmapper</h1>
        <h2>KMapper - PHP MySql Query Builder</h2>
        <a href="https://github.com/katropine/kmapper" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h3>
<a id="welcome-to-kmapper---php-mysql-query-builder" class="anchor" href="#welcome-to-kmapper---php-mysql-query-builder" aria-hidden="true"><span class="octicon octicon-link"></span></a>Welcome to KMapper - PHP MySql Query Builder.</h3>

<h1>
<a id="kmapper---mysql-database-layer" class="anchor" href="#kmapper---mysql-database-layer" aria-hidden="true"><span class="octicon octicon-link"></span></a>KMapper - MySql Database Layer</h1>

<p>KMapper library is a PHP toolkit for accessing and manipulate MySql database. It provides a query builder class called TableMapper. KMapper is a PDO wrapper library.
Data is returned as associative array. </p>

<h1>
<a id="instructions" class="anchor" href="#instructions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Instructions</h1>

<p>First create a <code>kmapper.php</code> file in your <code>/app/config</code> or <code>/application/config</code> or <code>/config</code> directory with content.</p>

<ul>
<li>For non MVC framework use define <code>kmapper.php</code> config path with <code>define('KMAPPER_CONFIG_LOCATION', '/my/cistom/path')</code>
</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">return</span> <span class="pl-c1">array</span>(</span>
<span class="pl-s1">    <span class="pl-c">// default mandatory</span></span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>default<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">array</span>(</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>host<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>localhost<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>dbname<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>kdbtest<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>root<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>superpass<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>prefix<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>pdoattributes<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-c1">array</span>(<span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">ATTR_DEFAULT_FETCH_MODE</span>, <span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">FETCH_ASSOC</span>),</span>
<span class="pl-s1">            <span class="pl-c1">array</span>(<span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">ATTR_ERRMODE</span>, <span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">ERRMODE_EXCEPTION</span>),</span>
<span class="pl-s1">            <span class="pl-c1">array</span>(<span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">ATTR_EMULATE_PREPARES</span>, <span class="pl-c1">false</span>)</span>
<span class="pl-s1">        )</span>
<span class="pl-s1">    ),</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>db1<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">array</span>(</span>
<span class="pl-s1">       <span class="pl-s"><span class="pl-pds">'</span>host<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>localhost<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>dbname<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>otherdatabase<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>root<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>superpass<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>prefix<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>test<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>pdoattributes<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-c1">array</span>(<span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">ATTR_DEFAULT_FETCH_MODE</span>, <span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">FETCH_ASSOC</span>),</span>
<span class="pl-s1">            <span class="pl-c1">array</span>(<span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">ATTR_ERRMODE</span>, <span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">ERRMODE_EXCEPTION</span>),</span>
<span class="pl-s1">            <span class="pl-c1">array</span>(<span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">ATTR_EMULATE_PREPARES</span>, <span class="pl-c1">false</span>)</span>
<span class="pl-s1">        )</span>
<span class="pl-s1"></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">);</span></pre></div>

<h2>
<a id="execute-first-query" class="anchor" href="#execute-first-query" aria-hidden="true"><span class="octicon octicon-link"></span></a>Execute first query:</h2>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$DataObject</span> <span class="pl-k">=</span> <span class="pl-c1">\KMapper\</span><span class="pl-c1">MySql</span><span class="pl-k">::</span>query(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> t1</span><span class="pl-pds">"</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$DataObject</span> <span class="pl-k">=</span> <span class="pl-c1">\KMapper\</span><span class="pl-c1">MySql</span><span class="pl-k">::</span>execute(</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> <span class="pl-s">`#__t1`</span> <span class="pl-k">WHERE</span> id <span class="pl-k">=</span> ? <span class="pl-k">AND</span> age <span class="pl-k">=</span> ?</span><span class="pl-pds">"</span></span>, </span>
<span class="pl-s1">    <span class="pl-c1">array</span>(</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(<span class="pl-c1">12</span>,<span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">PARAM_INT</span>), </span>
<span class="pl-s1">        <span class="pl-c1">array</span>(<span class="pl-c1">25</span>, <span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">PARAM_INT</span>)</span>
<span class="pl-s1">    )</span>
<span class="pl-s1">);</span>
<span class="pl-s1"><span class="pl-smi">$DataObject</span> <span class="pl-k">=</span> <span class="pl-c1">\KMapper\</span><span class="pl-c1">MySql</span><span class="pl-k">::</span>execute(</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> <span class="pl-s">`#__t1`</span> <span class="pl-k">WHERE</span> id <span class="pl-k">=</span> :id <span class="pl-k">AND</span> age <span class="pl-k">=</span> :age</span><span class="pl-pds">"</span></span>, </span>
<span class="pl-s1">    <span class="pl-c1">array</span>(</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>:id<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">12</span>,<span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">PARAM_INT</span>), </span>
<span class="pl-s1">        <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>:age<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">25</span>, <span class="pl-c1">\PDO</span><span class="pl-k">::</span><span class="pl-c1">PARAM_INT</span>)</span>
<span class="pl-s1">    )</span>
<span class="pl-s1">);</span></pre></div>

<p>Table Prefix:</p>

<pre><code>#__ is a placeholder, it will be replaced with the value from 'prefix' in config.
</code></pre>

<h2>
<a id="multiple-database-connections" class="anchor" href="#multiple-database-connections" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multiple database connections</h2>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$options</span>[<span class="pl-s"><span class="pl-pds">'</span>connection<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-k">new</span>  <span class="pl-c1">KMapper\</span><span class="pl-c1">MySqlDbConnect</span>(<span class="pl-s"><span class="pl-pds">'</span>db1<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$DataObject</span> <span class="pl-k">=</span> <span class="pl-c1">\KMapper\</span><span class="pl-c1">MySql</span><span class="pl-k">::</span>query(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> <span class="pl-c">#__t1</span></span><span class="pl-pds">"</span></span>, <span class="pl-smi">$options</span>);</span>
<span class="pl-s1"><span class="pl-smi">$DataObject</span> <span class="pl-k">=</span> <span class="pl-c1">\KMapper\</span><span class="pl-c1">MySql</span><span class="pl-k">::</span>execute(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> <span class="pl-c">#__t1 WHERE id = ?</span></span><span class="pl-pds">"</span></span>, <span class="pl-c1">array</span>(<span class="pl-c1">12</span>), <span class="pl-smi">$options</span>);</span></pre></div>

<h2>
<a id="query-builder" class="anchor" href="#query-builder" aria-hidden="true"><span class="octicon octicon-link"></span></a>Query Builder</h2>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$UserMP</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">\KMapper\</span><span class="pl-c1">TabelMapper</span>(<span class="pl-s"><span class="pl-pds">"</span>#__user<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">'</span>usr<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$UsersDataObject</span> <span class="pl-k">=</span> <span class="pl-smi">$UserMP</span><span class="pl-k">-&gt;</span>setSelect(<span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">"</span>usr.first_name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>usr.last_name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>addr.zip<span class="pl-pds">"</span></span>))</span>
<span class="pl-s1">                    <span class="pl-c">// table1, joinField1, onTable2, onField2, table1Alias</span></span>
<span class="pl-s1">                    <span class="pl-k">-&gt;</span>setInnerJoin(<span class="pl-s"><span class="pl-pds">"</span>#__address<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>id_user<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>usr<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>addr<span class="pl-pds">"</span></span>)</span>
<span class="pl-s1">                    <span class="pl-k">-&gt;</span>setWhere(<span class="pl-s"><span class="pl-pds">"</span>usr.status != ? AND usr.smart = ? AND (addr.zip = ? OR addr.zip = ?)<span class="pl-pds">"</span></span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>banned<span class="pl-pds">'</span></span>, <span class="pl-c1">false</span>, <span class="pl-s"><span class="pl-pds">'</span>23000<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>21000<span class="pl-pds">'</span></span>))</span>
<span class="pl-s1">                    <span class="pl-k">-&gt;</span>setOrderBy(<span class="pl-s"><span class="pl-pds">"</span>usr.name ASC<span class="pl-pds">"</span></span>)</span>
<span class="pl-s1">                    <span class="pl-k">-&gt;</span>fetchAll();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$UsersDataObject</span><span class="pl-k">-&gt;</span>toArray());</span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$UsersDataObject</span><span class="pl-k">-&gt;</span>toJson());</span></pre></div>

<h2>
<a id="insert--update" class="anchor" href="#insert--update" aria-hidden="true"><span class="octicon octicon-link"></span></a>Insert &amp; Update</h2>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$UserMP</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">\KMapper\</span><span class="pl-c1">TabelMapper</span>(<span class="pl-s"><span class="pl-pds">"</span>#__user<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$data</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>first_name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Fu<span class="pl-pds">"</span></span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>last_name<span class="pl-pds">'</span></span>  <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Bar<span class="pl-pds">"</span></span> </span>
<span class="pl-s1">);</span>
<span class="pl-s1"><span class="pl-c">// INSERT, no id provided</span></span>
<span class="pl-s1"><span class="pl-smi">$UserMP</span><span class="pl-k">-&gt;</span>save(<span class="pl-smi">$data</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$data</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">22</span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>first_name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Fu<span class="pl-pds">"</span></span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>last_name<span class="pl-pds">'</span></span>  <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Bar<span class="pl-pds">"</span></span> </span>
<span class="pl-s1">);</span>
<span class="pl-s1"><span class="pl-c">// UPDATE where id = 22</span></span>
<span class="pl-s1"><span class="pl-smi">$UserMP</span><span class="pl-k">-&gt;</span>save(<span class="pl-smi">$data</span>);</span></pre></div>

<p>In case "id" is not the primary key name, key has to be defined:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$UserMP</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">\KMapper\</span><span class="pl-c1">TabelMapper</span>(<span class="pl-s"><span class="pl-pds">"</span>#__user<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$UserMP</span><span class="pl-k">-&gt;</span>setPrimaryKeyName(<span class="pl-s"><span class="pl-pds">'</span>my_unstandard_id<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>save(<span class="pl-smi">$data</span>);</span></pre></div>

<h2>
<a id="mutiple-update--insert" class="anchor" href="#mutiple-update--insert" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mutiple UPDATE &amp; INSERT</h2>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$UserMP</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">\KMapper\</span><span class="pl-c1">TabelMapper</span>(<span class="pl-s"><span class="pl-pds">"</span>#__user<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$data</span> <span class="pl-k">=</span> <span class="pl-k">array</span></span>
<span class="pl-s1">    <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>first_name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Kriss<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>last_name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Kristiansen<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>first_name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Johnny<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>last_name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Johnosn<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1"></span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$UserMP</span><span class="pl-k">-&gt;</span>batchSave(<span class="pl-smi">$data</span>);</span></pre></div>

<h2>
<a id="where-id-in-" class="anchor" href="#where-id-in-" aria-hidden="true"><span class="octicon octicon-link"></span></a>WHERE id IN ()</h2>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$roles</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-c1">1</span>,<span class="pl-c1">2</span>,<span class="pl-c1">5</span>,<span class="pl-c1">8</span>);</span>
<span class="pl-s1"><span class="pl-c">// set placeholders</span></span>
<span class="pl-s1"><span class="pl-smi">$inPlaceholders</span> <span class="pl-k">=</span><span class="pl-c1">\KMapper\</span><span class="pl-c1">MySql</span><span class="pl-k">::</span>getPlaceholders(<span class="pl-smi">$roles</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$i</span> <span class="pl-k">=</span> <span class="pl-c1">KMapper\</span><span class="pl-c1">TableMapper</span><span class="pl-k">::</span>getInstance()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setFrom(<span class="pl-s"><span class="pl-pds">'</span>#__user<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setWhere(<span class="pl-s"><span class="pl-pds">"</span>`user_id` = ? AND `group_id` IN ( {<span class="pl-smi">$inPlaceholders</span>} )<span class="pl-pds">"</span></span>, <span class="pl-c1">array_merge</span>(<span class="pl-c1">array</span>(<span class="pl-smi">$user</span><span class="pl-k">-&gt;</span>getId()),<span class="pl-smi">$roles</span>))</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>countAll();</span>
<span class="pl-s1"></span></pre></div>

<h2>
<a id="transactions" class="anchor" href="#transactions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Transactions</h2>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">try</span>{</span>
<span class="pl-s1">    <span class="pl-c1">\KMapper\</span><span class="pl-c1">MySql</span><span class="pl-k">::</span>transactionBegin());</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$last</span> <span class="pl-k">=</span> <span class="pl-c1">\KMapper\</span><span class="pl-c1">MySql</span><span class="pl-k">::</span>query(<span class="pl-smi">$sqlTask</span>)<span class="pl-k">-&gt;</span>getLastID();</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">if</span>(<span class="pl-k">!</span><span class="pl-smi">$last</span>){</span>
<span class="pl-s1">        <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-c1">\Exception</span>(<span class="pl-s"><span class="pl-pds">"</span>Could not insert<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">if</span>(<span class="pl-k">!</span><span class="pl-c1">\KMapper\</span><span class="pl-c1">MySql</span><span class="pl-k">::</span>query(<span class="pl-smi">$sqlHierarchy</span>)<span class="pl-k">-&gt;</span>isSuccess()){</span>
<span class="pl-s1">        <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-c1">\Exception</span>(<span class="pl-s"><span class="pl-pds">"</span>Query error<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c1">\KMapper\</span><span class="pl-c1">MySql</span><span class="pl-k">::</span>transactionCommit());</span>
<span class="pl-s1"></span>
<span class="pl-s1">}  <span class="pl-k">catch</span> (<span class="pl-c1">PDOException</span> <span class="pl-smi">$E</span>){</span>
<span class="pl-s1">    <span class="pl-c1">\KMapper\</span><span class="pl-c1">MySql</span><span class="pl-k">::</span>transactionRollback();</span>
<span class="pl-s1">}  <span class="pl-k">catch</span> (<span class="pl-c1">Exception</span> <span class="pl-smi">$E</span>){</span>
<span class="pl-s1">    <span class="pl-c1">\KMapper\</span><span class="pl-c1">MySql</span><span class="pl-k">::</span>transactionRollback();</span>
<span class="pl-s1">}</span></pre></div>

<h2>
<a id="install-kmapper-with-composer" class="anchor" href="#install-kmapper-with-composer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install KMapper with Composer</h2>

<pre><code>"require": {
    "katropine/kmapper" : "dev-master"
}
</code></pre>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/katropine/kmapper/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/katropine/kmapper/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/katropine/kmapper"></a> is maintained by <a href="https://github.com/katropine">katropine</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
